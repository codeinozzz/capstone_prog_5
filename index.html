<!DOCTYPE html>
<html>
<head>
    <title>Debug Clerk Token</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; }
        #status { background: #f0f0f0; padding: 15px; margin: 10px 0; }
        #token { background: #e8f5e8; padding: 15px; word-break: break-all; margin: 10px 0; }
        .error { color: red; background: #ffe6e6; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Debug Clerk Token</h1>
    
    <div id="status">üîÑ Initializing Clerk...</div>
    
    <button onclick="signIn()" id="signInBtn" disabled>Sign In</button>
    <button onclick="signUp()" id="signUpBtn" disabled>Sign Up</button>
    <button onclick="signOut()" id="signOutBtn" disabled>Sign Out</button>
    
    <div id="token">No token yet</div>
    
    <script>
        console.log('üöÄ Script started');
        
        let currentUser = null;
        let clerkLoaded = false;
        
        // Manual Clerk loading
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/@clerk/clerk-js@latest/dist/clerk.browser.js';
        script.setAttribute('data-clerk-publishable-key', 'pk_test_cG9saXNoZWQtc2hhZC0zMC5jbGVyay5hY2NvdW50cy5kZXYk');
        
        script.onload = async () => {
            console.log('üì¶ Clerk script loaded');
            updateStatus('üì¶ Clerk script loaded, initializing...');
            
            try {
                await window.Clerk.load();
                console.log('‚úÖ Clerk initialized');
                clerkLoaded = true;
                
                updateStatus('‚úÖ Clerk ready! You can now sign in.');
                enableButtons();
                
                window.Clerk.addListener(({ user }) => {
                    console.log('üë§ User changed:', user);
                    currentUser = user;
                    updateUserStatus();
                });
                
                updateUserStatus();
                
            } catch (error) {
                console.error('‚ùå Clerk init error:', error);
                updateStatus('‚ùå Clerk failed to initialize: ' + error.message, true);
            }
        };
        
        script.onerror = () => {
            console.error('‚ùå Failed to load Clerk script');
            updateStatus('‚ùå Failed to load Clerk script from CDN', true);
        };
        
        document.head.appendChild(script);
        
        function updateStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = isError ? 'error' : '';
        }
        
        function enableButtons() {
            document.getElementById('signInBtn').disabled = false;
            document.getElementById('signUpBtn').disabled = false;
            document.getElementById('signOutBtn').disabled = false;
        }
        
        function updateUserStatus() {
            if (currentUser) {
                updateStatus(`‚úÖ Logged in as: ${currentUser.emailAddresses[0].emailAddress}`);
                showToken();
            } else {
                updateStatus('‚ÑπÔ∏è Not logged in. Click Sign In or Sign Up.');
                document.getElementById('token').textContent = 'No token - please sign in first';
            }
        }
        
        async function showToken() {
            try {
                const token = await window.Clerk.session.getToken();
                document.getElementById('token').textContent = token;
                console.log('üîë Token:', token.substring(0, 50) + '...');
            } catch (error) {
                console.error('‚ùå Token error:', error);
                document.getElementById('token').textContent = 'Error getting token: ' + error.message;
            }
        }
        
        async function signIn() {
            if (!clerkLoaded) {
                alert('Clerk not loaded yet!');
                return;
            }
            console.log('üîê Opening sign in...');
            try {
                await window.Clerk.openSignIn({});
            } catch (error) {
                console.error('‚ùå Sign in error:', error);
                alert('Sign in error: ' + error.message);
            }
        }
        
        async function signUp() {
            if (!clerkLoaded) {
                alert('Clerk not loaded yet!');
                return;
            }
            console.log('üìù Opening sign up...');
            try {
                await window.Clerk.openSignUp({});
            } catch (error) {
                console.error('‚ùå Sign up error:', error);
                alert('Sign up error: ' + error.message);
            }
        }
        
        async function signOut() {
            if (!clerkLoaded) {
                alert('Clerk not loaded yet!');
                return;
            }
            console.log('üö™ Signing out...');
            try {
                await window.Clerk.signOut();
            } catch (error) {
                console.error('‚ùå Sign out error:', error);
                alert('Sign out error: ' + error.message);
            }
        }
    </script>
</body>
</html>